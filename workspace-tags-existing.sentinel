import "tfrun"
import "tfstate/v2" as tfstate

checkTag = func(tags) {
  print(tags)
  return tags and tags.Workspace and tags.Workspace is tfrun.workspace.name
}

notTagged = func(values) {
  print(values)
  return !(checkTag(values.tags) or checkTag(values.tags_all))
}

debugger = func(r) {
  print(length(r))
  print(r)
  return notTagged(r.values)
}

allTagViolations = filter tfstate.resources as _, r {
  debugger(r)
}

main = rule {
  allTagViolations
}